<!DOCTYPE html>
<html>
<head>
    <title>Contact Access Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        button { padding: 15px 30px; font-size: 16px; margin: 10px; }
        #contactsList { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .contact { padding: 10px; border-bottom: 1px solid #eee; }
        .error { color: red; padding: 10px; background: #ffeeee; }
        .success { color: green; padding: 10px; background: #eeffee; }
    </style>
</head>
<body>
    <h2>Contact Access Demo</h2>
    <p>This demonstrates how modern browsers handle contact access:</p>
    
    <button onclick="requestContacts()">Select Contacts</button>
    <button onclick="requestContactsWithProperties()">Select Contacts (Detailed)</button>
    
    <div id="status"></div>
    <div id="contactsList"></div>

    <script>
        async function requestContacts() {
            const statusDiv = document.getElementById('status');
            const contactsList = document.getElementById('contactsList');
            
            try {
                // Check if Contact Picker API is supported
                if (!('contacts' in navigator && 'select' in navigator.contacts)) {
                    statusDiv.innerHTML = '<div class="error">Contact Picker API not supported in this browser</div>';
                    return;
                }

                statusDiv.innerHTML = '<div>Opening contact picker...</div>';
                
                // Request contacts - user must manually select
                const contacts = await navigator.contacts.select(
                    ['name', 'email', 'tel'], 
                    { multiple: true }
                );

                if (contacts.length === 0) {
                    statusDiv.innerHTML = '<div class="error">No contacts selected</div>';
                    return;
                }

                // Display selected contacts
                statusDiv.innerHTML = `<div class="success">Selected ${contacts.length} contact(s)</div>`;
                contactsList.innerHTML = '<h3>Selected Contacts:</h3>';
                
                contacts.forEach((contact, index) => {
                    const contactDiv = document.createElement('div');
                    contactDiv.className = 'contact';
                    contactDiv.innerHTML = `
                        <strong>Contact ${index + 1}:</strong><br>
                        Name: ${contact.name || 'Not provided'}<br>
                        Email: ${contact.email || 'Not provided'}<br>
                        Phone: ${contact.tel || 'Not provided'}<br>
                    `;
                    contactsList.appendChild(contactDiv);
                });

            } catch (error) {
                statusDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
                console.error('Contact picker error:', error);
            }
        }

        async function requestContactsWithProperties() {
            const statusDiv = document.getElementById('status');
            const contactsList = document.getElementById('contactsList');
            
            try {
                if (!('contacts' in navigator && 'select' in navigator.contacts)) {
                    statusDiv.innerHTML = '<div class="error">Contact Picker API not supported</div>';
                    return;
                }

                // Request specific properties
                const properties = ['name', 'email', 'tel', 'address', 'icon'];
                const contacts = await navigator.contacts.select(properties, { 
                    multiple: true 
                });

                if (contacts.length === 0) {
                    statusDiv.innerHTML = '<div class="error">No contacts selected</div>';
                    return;
                }

                statusDiv.innerHTML = `<div class="success">Selected ${contacts.length} contact(s) with detailed info</div>`;
                contactsList.innerHTML = '<h3>Detailed Contact Info:</h3>';
                
                contacts.forEach((contact, index) => {
                    const contactDiv = document.createElement('div');
                    contactDiv.className = 'contact';
                    
                    let contactHTML = `<strong>Contact ${index + 1}:</strong><br>`;
                    
                    if (contact.name && contact.name.length > 0) {
                        contactHTML += `Name: ${contact.name.join(', ')}<br>`;
                    }
                    
                    if (contact.email && contact.email.length > 0) {
                        contactHTML += `Email: ${contact.email.join(', ')}<br>`;
                    }
                    
                    if (contact.tel && contact.tel.length > 0) {
                        contactHTML += `Phone: ${contact.tel.join(', ')}<br>`;
                    }
                    
                    if (contact.address && contact.address.length > 0) {
                        contactHTML += `Address: ${contact.address.join(', ')}<br>`;
                    }
                    
                    contactDiv.innerHTML = contactHTML;
                    contactsList.appendChild(contactDiv);
                });

            } catch (error) {
                statusDiv.innerHTML = `<div class="error">Error: ${error.message}</div>`;
            }
        }

        // Check browser support on load
        window.addEventListener('load', () => {
            const statusDiv = document.getElementById('status');
            
            if ('contacts' in navigator && 'select' in navigator.contacts) {
                statusDiv.innerHTML = '<div class="success">Contact Picker API is supported</div>';
            } else {
                statusDiv.innerHTML = `
                    <div class="error">
                        Contact Picker API not supported in your browser.<br>
                        Supported browsers: Chrome 80+, Edge 80+, Opera 67+<br>
                        <strong>Note:</strong> This API requires HTTPS and user interaction
                    </div>
                `;
            }
        });
    </script>
</body>
</html>